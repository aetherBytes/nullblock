name: nullblock-dev
root: ~/nullblock
startup_window: logs

windows:
  - logs:
      layout: tiled
      panes:
        - |
          echo "ðŸŒ OpenRouter API Logs"
          echo "Monitoring OpenRouter API usage and agent requests..."
          echo "Press Ctrl+C to stop"
          echo ""
          mkdir -p logs
          touch logs/openrouter-api.log
          echo "ðŸ“Š Monitoring OpenRouter API requests..."
          tail -f logs/openrouter-api.log 2>/dev/null || echo "âš ï¸ Waiting for OpenRouter API logs..."
        - |
          echo "ðŸ§  LLM Service Health Monitor"
          echo "Monitoring LLM service health and model availability..."
          echo ""
          cd svc/nullblock-agents
          while true; do
            echo "$(date '+%Y-%m-%d %H:%M:%S') [LLM-HEALTH] Checking model availability..." | tee -a logs/llm-health.log
            python scripts/health_check.py 2>&1 | tee -a logs/llm-health.log
            sleep 30
          done
        - |
          echo "ðŸŽ¯ Hecate Agent Logs"
          echo "Monitoring Hecate agent server and client logs..."
          echo ""
          mkdir -p svc/nullblock-agents/logs
          touch svc/nullblock-agents/logs/hecate-server.log
          tail -f svc/nullblock-agents/logs/hecate-server.log 2>/dev/null || echo "âš ï¸ Waiting for Hecate logs..."
        - |
          echo "ðŸ’¬ Chat Conversations"
          echo "Real-time monitoring of chat conversations with Hecate..."
          echo "View your conversations and model responses as they happen"
          echo ""
          mkdir -p svc/nullblock-agents/logs/chats
          touch svc/nullblock-agents/logs/chats/hecate-chat.log
          echo "ðŸ“ Monitoring chat log: logs/chats/hecate-chat.log"
          tail -f svc/nullblock-agents/logs/chats/hecate-chat.log 2>/dev/null || echo "âš ï¸ Waiting for chat conversations..."
        - ~/nullblock/scripts/health-monitor.sh
        - |
          echo "ðŸŒ MCP Server Logs"
          echo "Monitoring MCP server logs..."
          echo ""
          mkdir -p svc/nullblock-mcp/logs
          touch svc/nullblock-mcp/logs/mcp-server.log
          tail -f svc/nullblock-mcp/logs/mcp-server.log 2>/dev/null || echo "âš ï¸ Waiting for MCP logs..."
        - |
          echo "ðŸ”— Erebus Server Logs"
          echo "Monitoring Erebus wallet server logs..."
          echo ""
          cd svc/erebus
          mkdir -p logs
          LOG_FILE="logs/erebus.log.$(date +%Y-%m-%d)"
          touch "$LOG_FILE"
          echo "ðŸ“ Tailing: $LOG_FILE"
          tail -f "$LOG_FILE" 2>/dev/null || echo "âš ï¸ Waiting for Erebus logs..."

  - workspace:
      layout: even-horizontal
      panes:
        - |
          echo "Nullblock Main Repository"
          echo "Available commands:"
          echo "  just help - Show all commands"
          echo "  just dev-tmux - Launch dev environment"
          echo "  just start - Start all services"
          echo "  just status - Check service status"
          cd ~/nullblock
        - |
          echo "Nullblock SDK Repository"
          echo "Available commands:"
          echo "  npm run build - Build SDK"
          echo "  npm test - Run tests"
          echo "  npm run docs - Generate docs"
          cd ~/nullblock-sdk

  - infrastructure:
      layout: even-horizontal
      panes:
        - |
          echo "Starting PostgreSQL..."
          brew services start postgresql@17
          echo "PostgreSQL started"
        - |
          echo "Starting Redis..."  
          brew services start redis
          echo "Redis started"
        - |
          echo "Starting IPFS..."
          ipfs daemon --enable-gc

  - backend:
      layout: tiled
      pre_window: |
        if [ -f .env.dev ]; then
          export $(grep -v '^#' .env.dev | xargs -0)
        fi
      panes:
        - |
          echo "Starting MCP Server..."
          cd svc/nullblock-mcp
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          export MCP_SERVER_HOST=0.0.0.0
          export MCP_SERVER_PORT=8001
          hatch run python3 -m mcp
        - |
          echo "Starting Orchestration..."
          cd svc/nullblock-orchestration
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          export ORCHESTRATION_HOST=0.0.0.0
          export ORCHESTRATION_PORT=8002
          hatch run python3 -m orchestration
        - |
          echo "Starting Erebus Server (Rust)..."
          cd svc/erebus
          mkdir -p logs
          export EREBUS_HOST=127.0.0.1
          export EREBUS_PORT=3000
          echo "ðŸ“ Logs will be written to logs/erebus.log"
          cargo run 2>&1 | tee logs/erebus.log

  - agents:
      layout: even-horizontal
      pre_window: |
        if [ -f .env.dev ]; then
          export $(grep -v '^#' .env.dev | xargs -0)
        fi
      panes:
        - |
          echo "ðŸ¤– Starting Nullblock Agents Server..."
          cd svc/nullblock-agents
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          echo "Creating logs directory..."
          mkdir -p logs
          export AGENTS_HOST=0.0.0.0
          export AGENTS_PORT=9001
          echo "ðŸš€ Starting general agents server on port 9001..."
          echo "ðŸ“ Logs will be written to logs/agents.log"
          echo "ðŸ’¡ Use 'tail -f logs/agents.log' to monitor logs"
          hatch run python3 -m agents
        - |
          echo "ðŸŽ¯ Starting Hecate Agent Server with OpenRouter..."
          echo "ðŸ“‹ Using OpenRouter for LLM services (no local dependencies)"
          echo ""
          cd svc/nullblock-agents
          mkdir -p logs
          export HECATE_PORT=9002
          echo "ðŸš€ Starting Hecate agent server on port 9002..."
          echo "ðŸ“ Logs will be written to logs/hecate-server.log"
          echo "ðŸŒ Using OpenRouter API for model access"
          hatch run python -m agents.hecate.server 2>&1 | tee logs/hecate-server.log

  - frontend:
      panes:
        - |
          echo "Starting Frontend..."
          cd svc/hecate
          echo "Installing/updating npm dependencies..."
          npm install
          export VITE_MCP_API_URL=http://localhost:8001
          export VITE_EREBUS_API_URL=http://localhost:3000
          export VITE_ORCHESTRATION_API_URL=http://localhost:8002
          export VITE_AGENTS_API_URL=http://localhost:9001
          export VITE_HECATE_API_URL=http://localhost:9002
          npm run develop

  - llm:
      layout: even-horizontal
      panes:
        - |
          echo "ðŸŒ OpenRouter Integration Status"
          echo "Monitoring OpenRouter API connectivity and model availability..."
          echo ""
          mkdir -p logs
          touch logs/openrouter-status.log
          echo "âœ… OpenRouter is cloud-based - no local server needed"
          echo "ðŸ”‘ API Key configured via .env.dev"
          echo "ðŸ“Š Available models:"
          echo "   - deepseek/deepseek-chat-v3.1:free (default, $0.00)"
          echo "   - deepseek/deepseek-r1 (reasoning, ~$0.0014)"
          echo "   - openai/gpt-4o (premium, ~$0.005)"
          echo "   - anthropic/claude-3.5-sonnet (premium, ~$0.003)"
          echo ""
          echo "ðŸ“¡ Testing OpenRouter connectivity..."
          cd svc/nullblock-agents
          python scripts/health_check.py | tee logs/openrouter-status.log
        - |
          echo "ðŸ§  Model Performance Monitor"
          echo "Real-time monitoring of LLM requests and costs..."
          echo ""
          cd svc/nullblock-agents
          mkdir -p logs
          while true; do
            echo "$(date '+%Y-%m-%d %H:%M:%S') [MODEL-PERF] Checking usage stats..." | tee -a logs/model-performance.log
            python scripts/get_stats.py 2>&1 | tee -a logs/model-performance.log
            sleep 60
          done
        - |
          echo "ðŸ” Reasoning Tokens Monitor"
          echo "Monitoring reasoning model usage and token consumption..."
          echo ""
          cd svc/nullblock-agents
          mkdir -p logs
          touch logs/reasoning-monitor.log
          echo "ðŸ§  Reasoning models available:"
          python scripts/get_reasoning_models.py | tee logs/reasoning-monitor.log
          echo ""
          echo "ðŸ“Š Monitor logs: tail -f logs/reasoning-monitor.log"
          tail -f logs/reasoning-monitor.log 2>/dev/null || echo "âš ï¸ Waiting for reasoning logs..."

on_project_start: |
  if [ ! -f .env.dev ]; then
    echo "Creating .env.dev file..."
    echo "# Nullblock Development Environment" > .env.dev
    echo "ETHEREUM_RPC_URL=https://eth-sepolia.alchemyapi.io/v2/your-key" >> .env.dev
    echo "Please edit .env.dev with your actual API keys"
  fi
  echo "ðŸ“ Creating comprehensive log directory structure..."
  mkdir -p logs
  mkdir -p svc/nullblock-agents/logs
  mkdir -p svc/nullblock-agents/logs/chats
  mkdir -p svc/nullblock-mcp/logs
  mkdir -p svc/nullblock-orchestration/logs
  mkdir -p svc/erebus/logs
  mkdir -p svc/hecate/logs
  echo "âœ… Log directories created with archival support"
  echo "ðŸš€ Nullblock development environment ready!"
  echo "ðŸ¤– Agents tab: General agents (9001) + Hecate server (9002) with OpenRouter integration"
  echo "ðŸŒ Frontend connects to Hecate agent for chat functionality"
  echo "ðŸ§  LLM tab: OpenRouter API monitoring + reasoning tokens + model performance"
  echo "ðŸ“ All services now have persistent log files with rotation"
  echo "ðŸ’¡ Unified logs tab shows OpenRouter API usage, agent logs, and chat conversations"
  echo "ðŸ’¬ Chat logs: Real-time conversation monitoring with timestamps and model info"
  echo "ðŸ—‚ï¸  Log locations:"
  echo "   - Main: logs/ (OpenRouter API, health checks)"
  echo "   - Agents: svc/nullblock-agents/logs/ (Hecate, LLM service, reasoning)"
  echo "   - Chat conversations: svc/nullblock-agents/logs/chats/ (session logs + main chat.log)"
  echo "   - MCP: svc/nullblock-mcp/logs/"
  echo "   - Orchestration: svc/nullblock-orchestration/logs/"
  echo "   - Erebus: svc/erebus/logs/"
  echo "ðŸ“Š OpenRouter Models:"
  echo "   - DeepSeek Chat Free (default): $0.00 per request"
  echo "   - DeepSeek-R1 (reasoning): ~$0.0014 per request"
  echo "   - GPT-4o (premium): ~$0.005 per request"
  echo "   - Claude 3.5 Sonnet (premium): ~$0.003 per request"

on_project_stop: |
  echo "Stopping development services..."
  brew services stop postgresql@17 2>/dev/null || true
  brew services stop redis 2>/dev/null || true
  pkill -f "ipfs daemon" 2>/dev/null || true
