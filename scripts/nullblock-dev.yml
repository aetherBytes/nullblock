name: nullblock-dev
root: ~/nullblock
startup_window: logs

windows:
  - logs:
      layout: tiled
      panes:
        - |
          echo "ðŸŽ¯ Rust Hecate Agent Logs"
          echo "Real-time monitoring of Rust agent activities and requests..."
          echo "ðŸ§  Model: deepseek/deepseek-chat-v3.1:free (default)"
          echo "âš¡ Provider: OpenRouter (cloud-based)"
          echo ""
          cd svc/nullblock-agents
          mkdir -p logs
          echo "ðŸ“ Monitoring live Rust agent output..."
          tail -f logs/hecate-rust.log 2>/dev/null || echo "âš ï¸ Waiting for Rust agent logs..."
        - |
          echo "ðŸ§  Agent Health Monitor"
          echo "Monitoring Rust agent service health and model status..."
          echo ""
          mkdir -p logs
          while true; do
            echo "$(date '+%Y-%m-%d %H:%M:%S') [HEALTH] Checking Rust agent..." | tee -a logs/agent-health.log
            if curl -s --max-time 5 "http://localhost:9003/hecate/health" > /dev/null 2>&1; then
              echo "$(date '+%Y-%m-%d %H:%M:%S') [HEALTH] âœ… Agent healthy" | tee -a logs/agent-health.log
              curl -s "http://localhost:9003/hecate/model-status" | jq -r '"Model: " + .current_model + " | Status: " + .status' 2>/dev/null | tee -a logs/agent-health.log
            else
              echo "$(date '+%Y-%m-%d %H:%M:%S') [HEALTH] âŒ Agent not responding" | tee -a logs/agent-health.log
            fi
            sleep 30
          done
        - ~/nullblock/scripts/health-monitor.sh
        - |
          echo "ðŸŒ MCP Server Logs"
          echo "Monitoring MCP server logs..."
          echo ""
          mkdir -p svc/nullblock-mcp/logs
          tail -f svc/nullblock-mcp/logs/mcp-server.log 2>/dev/null || echo "âš ï¸ Waiting for MCP logs..."
        - |
          echo "ðŸ”— Erebus Server Logs"
          echo "Monitoring Erebus unified router logs..."
          echo ""
          cd svc/erebus
          mkdir -p logs
          tail -f logs/erebus.log 2>/dev/null || echo "âš ï¸ Waiting for Erebus logs..."
        - |
          echo "ðŸ’» Nullblock Root Terminal"
          echo "Blank terminal for manual commands and debugging..."
          echo ""
          cd ~/nullblock

  - workspace:
      layout: even-horizontal
      panes:
        - |
          echo "Nullblock Main Repository"
          echo "Available commands:"
          echo "  just help - Show all commands"
          echo "  just dev-tmux - Launch dev environment"
          echo "  just start - Start all services"
          echo "  just status - Check service status"
          cd ~/nullblock
        - |
          echo "Nullblock SDK Repository"
          echo "Available commands:"
          echo "  npm run build - Build SDK"
          echo "  npm test - Run tests"
          echo "  npm run docs - Generate docs"
          cd ~/nullblock-sdk

  - infrastructure:
      layout: even-horizontal
      panes:
        - |
          echo "Starting PostgreSQL..."
          if [[ "$OSTYPE" == "darwin"* ]]; then
            brew services start postgresql@17
          elif command -v systemctl &> /dev/null; then
            systemctl --user start postgresql || echo "PostgreSQL service not available in user mode"
          else
            echo "Please start PostgreSQL manually using your system's service manager"
          fi
          echo "PostgreSQL started"
        - |
          echo "Starting Redis..."
          if [[ "$OSTYPE" == "darwin"* ]]; then
            brew services start redis
          elif command -v systemctl &> /dev/null; then
            if command -v pacman &> /dev/null; then
              systemctl --user start redis || echo "Redis service not available in user mode"
            else
              systemctl --user start redis-server || echo "Redis service not available in user mode"
            fi
          else
            echo "Please start Redis manually using your system's service manager"
          fi
          echo "Redis started"
        - |
          echo "Starting IPFS..."
          ipfs daemon --enable-gc

  - backend:
      layout: tiled
      pre_window: |
        if [ -f .env.dev ]; then
          export $(grep -v '^#' .env.dev | xargs -0)
        fi
      panes:
        - |
          echo "Starting MCP Server..."
          cd svc/nullblock-mcp
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          export MCP_SERVER_HOST=0.0.0.0
          export MCP_SERVER_PORT=8001
          hatch run python3 -m mcp
        - |
          echo "Starting Orchestration..."
          cd svc/nullblock-orchestration
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          export ORCHESTRATION_HOST=0.0.0.0
          export ORCHESTRATION_PORT=8002
          hatch run python3 -m orchestration
        - |
          echo "Starting Erebus Server (Rust)..."
          cd svc/erebus
          mkdir -p logs
          export EREBUS_HOST=127.0.0.1
          export EREBUS_PORT=3000
          echo "ðŸ“ Logs will be written to logs/erebus.log"
          cargo run 2>&1 | tee logs/erebus.log

  - agents:
      layout: even-horizontal
      pre_window: |
        if [ -f .env.dev ]; then
          export $(grep -v '^#' .env.dev | xargs -0)
        fi
      panes:
        - |
          echo "ðŸ¤– Starting General Agents Server (Python)..."
          cd svc/nullblock-agents
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          mkdir -p logs
          export AGENTS_HOST=0.0.0.0
          export AGENTS_PORT=9001
          echo "ðŸš€ Starting general agents server on port 9001..."
          hatch run python3 -m agents
        - |
          echo "ðŸŽ¯ Starting Hecate Agent Server (Rust)..."
          echo "ðŸ¦€ High-performance Rust implementation with OpenRouter"
          echo ""
          cd svc/nullblock-agents
          mkdir -p logs
          export AGENTS_PORT=9003
          echo "ðŸš€ Starting Rust agents service on port 9003..."
          echo "ðŸ“ Logs will be written to logs/hecate-rust.log"
          echo "ðŸŒ Using OpenRouter API for model access"
          cargo run --release 2>&1 | tee logs/hecate-rust.log

  - frontend:
      panes:
        - |
          echo "Starting Frontend..."
          cd svc/hecate
          echo "Installing/updating npm dependencies..."
          npm install
          export VITE_MCP_API_URL=http://localhost:8001
          export VITE_EREBUS_API_URL=http://localhost:3000
          export VITE_ORCHESTRATION_API_URL=http://localhost:8002
          export VITE_AGENTS_API_URL=http://localhost:9001
          export VITE_HECATE_API_URL=http://localhost:9003
          npm run develop

  - monitoring:
      layout: tiled
      panes:
        - |
          echo "ðŸŒ OpenRouter & Model Performance"
          echo "Monitoring OpenRouter connectivity and model performance..."
          echo ""
          mkdir -p logs
          echo "âœ… OpenRouter is cloud-based - no local server needed"
          echo "ðŸ”‘ API Key configured via .env.dev"
          echo "ðŸ“Š Testing connectivity and monitoring performance..."
          while true; do
            echo "$(date '+%Y-%m-%d %H:%M:%S') [OPENROUTER] Checking connectivity..." | tee -a logs/openrouter-performance.log
            if curl -s --max-time 5 "http://localhost:9003/hecate/available-models" > /dev/null 2>&1; then
              echo "âœ… Connected - Getting model stats..." | tee -a logs/openrouter-performance.log
              curl -s "http://localhost:9003/hecate/model-status" | jq -r '.stats.cost_tracking // {} | to_entries[] | "\(.key): $\(.value)"' 2>/dev/null | tee -a logs/openrouter-performance.log
            else
              echo "âŒ Connection failed" | tee -a logs/openrouter-performance.log
            fi
            sleep 60
          done
        - |
          echo "ðŸ§  Available Models & Capabilities"
          echo "Monitoring available models and their capabilities..."
          echo ""
          mkdir -p logs
          while true; do
            echo "$(date '+%Y-%m-%d %H:%M:%S') [MODELS] Updating model info..." | tee -a logs/model-info.log
            if curl -s --max-time 5 "http://localhost:9003/hecate/model-info" > /dev/null 2>&1; then
              curl -s "http://localhost:9003/hecate/model-info" | jq -r '. | "Current: \(.current_model // "unknown")"' 2>/dev/null | tee -a logs/model-info.log
              echo "ðŸ” Available models:" | tee -a logs/model-info.log
              echo "   - deepseek/deepseek-chat-v3.1:free ($0.00)" | tee -a logs/model-info.log
              echo "   - deepseek/deepseek-r1 (~$0.0014)" | tee -a logs/model-info.log
              echo "   - openai/gpt-4o (~$0.005)" | tee -a logs/model-info.log
              echo "   - anthropic/claude-3.5-sonnet (~$0.003)" | tee -a logs/model-info.log
            else
              echo "âŒ Could not get model info" | tee -a logs/model-info.log
            fi
            sleep 120
          done

on_project_start: |
  if [ ! -f .env.dev ]; then
    echo "Creating .env.dev file..."
    echo "# Nullblock Development Environment" > .env.dev
    echo "ETHEREUM_RPC_URL=https://eth-sepolia.alchemyapi.io/v2/your-key" >> .env.dev
    echo "OPENROUTER_API_KEY=your-openrouter-key-here" >> .env.dev
    echo "Please edit .env.dev with your actual API keys"
  fi
  echo "ðŸ“ Creating log directory structure..."
  mkdir -p logs
  mkdir -p svc/nullblock-agents/logs
  mkdir -p svc/nullblock-mcp/logs
  mkdir -p svc/nullblock-orchestration/logs
  mkdir -p svc/erebus/logs
  mkdir -p svc/hecate/logs
  echo "âœ… Log directories created"
  echo ""
  echo "ðŸš€ Nullblock Development Environment Ready!"
  echo "================================================"
  echo "ðŸ—ï¸  Architecture: Client â†” Erebus â†” Services"
  echo "ðŸ›¡ï¸  Security: All frontend requests route through Erebus (port 3000)"
  echo ""
  echo "ðŸ“¡ Service Ports:"
  echo "   ðŸŒ Erebus (unified router): http://localhost:3000"
  echo "   ðŸ§  MCP Server: http://localhost:8001"
  echo "   ðŸ”„ Orchestration: http://localhost:8002"
  echo "   ðŸ¤– General Agents: http://localhost:9001" 
  echo "   ðŸŽ¯ Hecate Agent (Rust): http://localhost:9003"
  echo "   ðŸŽ¨ Frontend: http://localhost:5173"
  echo ""
  echo "ðŸ¦€ Rust Services:"
  echo "   âœ… Hecate Agent - High-performance conversational AI"
  echo "   âœ… Erebus Router - Unified request routing & logging"
  echo ""
  echo "ðŸ§  LLM Integration:"
  echo "   âš¡ Provider: OpenRouter (cloud-based)"
  echo "   ðŸŽ¯ Default Model: deepseek/deepseek-chat-v3.1:free ($0.00)"
  echo "   ðŸ’° Cost Tracking: Real-time monitoring & analytics"
  echo ""
  echo "ðŸ“Š Tabs Overview:"
  echo "   ðŸ“ logs - Real-time service logs & health monitoring"
  echo "   ðŸ’» workspace - Development commands & SDK tools"
  echo "   ðŸ—ï¸  infrastructure - PostgreSQL, Redis, IPFS"
  echo "   ðŸ”§ backend - MCP, Orchestration, Erebus services"
  echo "   ðŸ¤– agents - General + Hecate (Rust) agent servers"
  echo "   ðŸŽ¨ frontend - React development server"
  echo "   ðŸ“Š monitoring - OpenRouter & model performance analytics"

on_project_stop: |
  echo "Stopping development services..."
  if [[ "$OSTYPE" == "darwin"* ]]; then
    brew services stop postgresql@17 2>/dev/null || true
    brew services stop redis 2>/dev/null || true
  elif command -v systemctl &> /dev/null; then
    systemctl --user stop postgresql 2>/dev/null || true
    if command -v pacman &> /dev/null; then
      systemctl --user stop redis 2>/dev/null || true
    else
      systemctl --user stop redis-server 2>/dev/null || true
    fi
  fi
  pkill -f "ipfs daemon" 2>/dev/null || true