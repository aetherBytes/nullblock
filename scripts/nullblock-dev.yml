name: nullblock-dev
root: ~/nullblock
startup_window: infrastructure

windows:
  - infrastructure:
      layout: even-horizontal
      panes:
        - |
          echo "Starting PostgreSQL..."
          brew services start postgresql@17
          echo "PostgreSQL started"
        - |
          echo "Starting Redis..."  
          brew services start redis
          echo "Redis started"
        - |
          echo "Starting IPFS..."
          ipfs daemon --enable-gc

  - backend:
      layout: tiled
      pre_window: |
        if [ -f .env.dev ]; then
          export $(grep -v '^#' .env.dev | xargs -0)
        fi
      panes:
        - |
          echo "Starting MCP Server..."
          cd svc/nullblock-mcp
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          export MCP_SERVER_HOST=0.0.0.0
          export MCP_SERVER_PORT=8001
          hatch run python3 -m mcp
        - |
          echo "Starting Orchestration..."
          cd svc/nullblock-orchestration
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          export ORCHESTRATION_HOST=0.0.0.0
          export ORCHESTRATION_PORT=8002
          hatch run python3 -m orchestration
        - |
          echo "Starting Erebus Server..."
          cd svc/erebus
          echo "Updating Rust dependencies..."
          cargo update
          export EREBUS_HOST=127.0.0.1
          export EREBUS_PORT=3000
          cargo run

  - agents:
      layout: even-horizontal
      pre_window: |
        if [ -f .env.dev ]; then
          export $(grep -v '^#' .env.dev | xargs -0)
        fi
      panes:
        - |
          echo "ðŸ¤– Starting Nullblock Agents Server..."
          cd svc/nullblock-agents
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          echo "Creating logs directory..."
          mkdir -p logs
          export AGENTS_HOST=0.0.0.0
          export AGENTS_PORT=9001
          echo "ðŸš€ Starting general agents server on port 9001..."
          echo "ðŸ“ Logs will be written to logs/agents.log"
          echo "ðŸ’¡ Use 'tail -f logs/agents.log' to monitor logs"
          hatch run python3 -m agents
        - |
          echo "ðŸŽ¯ Starting Hecate Agent Server with Dependencies..."
          echo "ðŸ“‹ This will wait for LM Studio to be ready before starting Hecate"
          echo ""
          exec ~/nullblock/scripts/start-hecate-with-deps.sh

  - frontend:
      panes:
        - |
          echo "Starting Frontend..."
          cd svc/hecate
          echo "Installing/updating npm dependencies..."
          npm install
          export VITE_MCP_API_URL=http://localhost:8001
          export VITE_EREBUS_API_URL=http://localhost:3000
          export VITE_ORCHESTRATION_API_URL=http://localhost:8002
          export VITE_AGENTS_API_URL=http://localhost:9001
          export VITE_HECATE_API_URL=http://localhost:9002
          npm run develop

  - llm:
      layout: even-horizontal
      panes:
        - ~/nullblock/scripts/start-lmstudio.sh
        - |
          echo "Waiting for LM Studio server to start..."
          sleep 10
          echo "ðŸ“Š Starting log monitoring..."
          echo "Press Ctrl+C to stop"
          echo ""
          echo "ðŸ“Š Monitoring LM Studio server logs..."
          while true; do 
            lms log stream 2>/dev/null || echo "âš ï¸  No recent log files found in LM Studio server logs"
            sleep 5
          done
        - ~/nullblock/scripts/wait-for-lmstudio.sh

  - logs:
      layout: even-horizontal
      panes:
        - ~/nullblock/scripts/unified-logs.sh
        - ~/nullblock/scripts/health-monitor.sh

  - workspace:
      layout: even-horizontal
      panes:
        - |
          echo "Nullblock Main Repository"
          echo "Available commands:"
          echo "  just help - Show all commands"
          echo "  just dev-tmux - Launch dev environment"
          echo "  just start - Start all services"
          echo "  just status - Check service status"
          cd ~/nullblock
        - |
          echo "Nullblock SDK Repository"
          echo "Available commands:"
          echo "  npm run build - Build SDK"
          echo "  npm test - Run tests"
          echo "  npm run docs - Generate docs"
          cd ~/nullblock-sdk

on_project_start: |
  if [ ! -f .env.dev ]; then
    echo "Creating .env.dev file..."
    echo "# Nullblock Development Environment" > .env.dev
    echo "ETHEREUM_RPC_URL=https://eth-sepolia.alchemyapi.io/v2/your-key" >> .env.dev
    echo "Please edit .env.dev with your actual API keys"
  fi
  echo "Creating logs directory for agent services..."
  mkdir -p logs
  echo "ðŸš€ Nullblock development environment ready!"
  echo "ðŸ¤– Agents tab: General agents (9001) + Hecate server (9002) with comprehensive logging"
  echo "ðŸŒ Frontend connects to Hecate agent for chat functionality"
  echo "ðŸ’¡ Use 'tail -f logs/*.log' to monitor all service logs"

on_project_stop: |
  echo "Stopping development services..."
  brew services stop postgresql@17 2>/dev/null || true
  brew services stop redis 2>/dev/null || true
  pkill -f "ipfs daemon" 2>/dev/null || true

