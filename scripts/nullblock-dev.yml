name: nullblock-dev
root: ~/nullblock
startup_window: monitoring

windows:
  - monitoring:
      layout: tiled
      panes:
        - |
          echo "ðŸŽ¯ NullBlock System Health Dashboard"
          echo "Comprehensive monitoring of all services and infrastructure..."
          echo ""
          mkdir -p logs
          while true; do
            clear
            echo "ðŸŽ¯ NullBlock System Health Dashboard - $(date '+%Y-%m-%d %H:%M:%S')"
            echo "==============================================================="
            echo ""

            # Service Health Checks
            echo "ðŸ“¡ Service Health Status:"
            for service in "erebus:3000" "nullblock-agents:9003" "nullblock-mcp:8001" "nullblock-orchestration:8002" "frontend:5173"; do
              name=$(echo $service | cut -d: -f1)
              port=$(echo $service | cut -d: -f2)
              if curl -s --max-time 3 "http://localhost:$port/health" > /dev/null 2>&1; then
                echo "  âœ… $name (port $port) - Healthy"
              else
                echo "  âŒ $name (port $port) - Not responding"
              fi
            done
            echo ""

            # Database Connections
            echo "ðŸ—„ï¸  Database Connections:"
            if pg_isready -h localhost -p 5432 > /dev/null 2>&1; then
              echo "  âœ… PostgreSQL - Connected"
            else
              echo "  âŒ PostgreSQL - Connection failed"
            fi

            if redis-cli ping > /dev/null 2>&1; then
              echo "  âœ… Redis - Connected"
            else
              echo "  âŒ Redis - Connection failed"
            fi
            echo ""

            # Kafka Health
            echo "ðŸ“¨ Event Streaming:"
            if docker ps | grep -q nullblock-kafka; then
              echo "  âœ… Kafka - Running"
              echo "  âœ… Zookeeper - Running"
            else
              echo "  âŒ Kafka/Zookeeper - Not running (use docker-compose up kafka zookeeper -d)"
            fi

            sleep 30
          done
        - |
          echo "ðŸ“Š Task Management Metrics"
          echo "Real-time task and event monitoring..."
          echo ""
          mkdir -p logs
          while true; do
            echo "$(date '+%Y-%m-%d %H:%M:%S') [METRICS] Task system status..." | tee -a logs/task-metrics.log
            if curl -s --max-time 5 "http://localhost:9003/tasks" > /dev/null 2>&1; then
              task_count=$(curl -s "http://localhost:9003/tasks" | jq '.total // 0' 2>/dev/null || echo "0")
              echo "ðŸ“‹ Total tasks: $task_count" | tee -a logs/task-metrics.log
              echo "ðŸŽ¯ Agent model status:" | tee -a logs/task-metrics.log
              curl -s "http://localhost:9003/hecate/model-status" | jq -r '"  Model: " + (.current_model // "unknown") + " | Status: " + (.status // "unknown")' 2>/dev/null | tee -a logs/task-metrics.log
            else
              echo "âŒ Task system not available" | tee -a logs/task-metrics.log
            fi
            sleep 45
          done
        - |
          echo "ðŸ”„ Quick API Testing"
          echo "Testing all service endpoints..."
          echo ""
          while true; do
            echo "ðŸ§ª API Endpoint Tests - $(date '+%H:%M:%S')"
            echo "curl http://localhost:3000/health (Erebus)"
            curl -s --max-time 3 "http://localhost:3000/health" | jq . 2>/dev/null || echo "âŒ Failed"
            echo ""
            echo "curl http://localhost:9003/health (Agents)"
            curl -s --max-time 3 "http://localhost:9003/health" | jq . 2>/dev/null || echo "âŒ Failed"
            echo ""
            echo "curl http://localhost:9003/tasks (Task Management)"
            curl -s --max-time 3 "http://localhost:9003/tasks" | jq '.total // "error"' 2>/dev/null || echo "âŒ Failed"
            sleep 60
          done

  - erebus:
      layout: tiled
      pre_window: |
        if [ -f .env.dev ]; then
          export $(grep -v '^#' .env.dev | xargs -0)
        fi
      panes:
        - |
          echo "ðŸ”— Starting Erebus Server (Rust)..."
          cd svc/erebus
          mkdir -p logs
          export EREBUS_HOST=127.0.0.1
          export EREBUS_PORT=3000
          export DATABASE_URL="postgresql://postgres:REDACTED_DB_PASS@localhost:5441/agents"
          export KAFKA_BOOTSTRAP_SERVERS="localhost:9092"
          echo "ðŸ“ Logs will be written to logs/erebus.log"
          cargo run 2>&1 | tee logs/erebus.log
        - |
          echo "ðŸ—„ï¸  Starting PostgreSQL for Erebus (Users DB)..."
          if [[ "$OSTYPE" == "darwin"* ]]; then
            brew services start postgresql@17
          elif command -v systemctl &> /dev/null; then
            systemctl --user start postgresql || echo "PostgreSQL service not available in user mode"
          else
            echo "Please start PostgreSQL manually"
          fi
          echo "âœ… PostgreSQL started for users database"
          echo ""
          echo "ðŸ“Š Database connection monitoring..."
          while true; do
            if pg_isready -h localhost -p 5432 > /dev/null 2>&1; then
              echo "$(date '+%H:%M:%S') âœ… PostgreSQL connection healthy"
            else
              echo "$(date '+%H:%M:%S') âŒ PostgreSQL connection failed"
            fi
            sleep 30
          done
        - |
          echo "ðŸ”„ Starting Redis for Erebus (Sessions)..."
          if [[ "$OSTYPE" == "darwin"* ]]; then
            brew services start redis
          elif command -v systemctl &> /dev/null; then
            if command -v pacman &> /dev/null; then
              systemctl --user start redis || echo "Redis service not available in user mode"
            else
              systemctl --user start redis-server || echo "Redis service not available in user mode"
            fi
          else
            echo "Please start Redis manually"
          fi
          echo "âœ… Redis started for session management"
          echo ""
          echo "ðŸ“Š Redis connection monitoring..."
          while true; do
            if redis-cli ping > /dev/null 2>&1; then
              echo "$(date '+%H:%M:%S') âœ… Redis connection healthy"
            else
              echo "$(date '+%H:%M:%S') âŒ Redis connection failed"
            fi
            sleep 30
          done
        - |
          echo "ðŸ“¡ Erebus Service Logs & Monitoring"
          echo "Monitoring Erebus unified router logs and user events..."
          echo ""
          cd svc/erebus
          mkdir -p logs
          echo "ðŸ“ Watching Erebus logs..."
          tail -f logs/erebus.log 2>/dev/null || echo "âš ï¸ Waiting for Erebus logs..."

  - nullblock-agents:
      layout: tiled
      pre_window: |
        if [ -f .env.dev ]; then
          export $(grep -v '^#' .env.dev | xargs -0)
        fi
      panes:
        - |
          echo "ðŸŽ¯ Starting Hecate Agent Server (Rust)..."
          echo "ðŸ¦€ High-performance Rust implementation with database & events"
          echo ""
          cd svc/nullblock-agents
          mkdir -p logs
          export AGENTS_PORT=9003
          export DATABASE_URL="postgresql://postgres:REDACTED_DB_PASS@localhost:5441/agents"
          export KAFKA_BOOTSTRAP_SERVERS="localhost:9092"
          echo "ðŸš€ Starting Rust agents service on port 9003..."
          echo "ðŸ“ Logs will be written to logs/hecate-rust.log"
          echo "ðŸ—„ï¸  Using PostgreSQL for task persistence"
          echo "ðŸ“¨ Using Kafka for event streaming"
          echo ""
          echo "ðŸ—„ï¸  Setting up database schema..."
          echo "ðŸ“‹ Running database migrations..."
          psql "$DATABASE_URL" -f migrations/001_create_tasks_table.sql 2>/dev/null || echo "Tasks table already exists"
          psql "$DATABASE_URL" -f migrations/002_create_agents_table.sql 2>/dev/null || echo "Agents table already exists"
          psql "$DATABASE_URL" -f migrations/003_create_user_references_table.sql 2>/dev/null || echo "User references table already exists"
          psql "$DATABASE_URL" -f migrations/004_add_foreign_key_constraints.sql 2>/dev/null || echo "Foreign key constraints already exist"
          echo "âœ… Database schema ready"
          echo ""
          cargo run --release 2>&1 | tee logs/hecate-rust.log
        - |
          echo "ðŸ—„ï¸  Agents Database Monitoring"
          echo "PostgreSQL monitoring for tasks, agents, user_references tables..."
          echo ""
          mkdir -p logs
          while true; do
            echo "$(date '+%Y-%m-%d %H:%M:%S') [DB] Agents database status..." | tee -a logs/agents-db.log
            if psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -c "SELECT COUNT(*) as task_count FROM tasks;" 2>/dev/null | grep -q "task_count"; then
              # Basic counts
              task_count=$(psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -t -c "SELECT COUNT(*) FROM tasks;" 2>/dev/null | xargs)
              user_ref_count=$(psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -t -c "SELECT COUNT(*) FROM user_references;" 2>/dev/null | xargs)
              agent_count=$(psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -t -c "SELECT COUNT(*) FROM agents;" 2>/dev/null | xargs)

              # Task status breakdown
              echo "ðŸ“Š Total: Tasks=$task_count | Users=$user_ref_count | Agents=$agent_count" | tee -a logs/agents-db.log

              # Task status distribution
              created_tasks=$(psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -t -c "SELECT COUNT(*) FROM tasks WHERE status='created';" 2>/dev/null | xargs)
              running_tasks=$(psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -t -c "SELECT COUNT(*) FROM tasks WHERE status='running';" 2>/dev/null | xargs)
              completed_tasks=$(psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -t -c "SELECT COUNT(*) FROM tasks WHERE status='completed';" 2>/dev/null | xargs)
              failed_tasks=$(psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -t -c "SELECT COUNT(*) FROM tasks WHERE status='failed';" 2>/dev/null | xargs)
              paused_tasks=$(psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -t -c "SELECT COUNT(*) FROM tasks WHERE status='paused';" 2>/dev/null | xargs)
              cancelled_tasks=$(psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -t -c "SELECT COUNT(*) FROM tasks WHERE status='cancelled';" 2>/dev/null | xargs)

              echo "ðŸ“‹ Status: Created=$created_tasks | Running=$running_tasks | Completed=$completed_tasks | Failed=$failed_tasks | Paused=$paused_tasks | Cancelled=$cancelled_tasks" | tee -a logs/agents-db.log

              # Recent activity
              recent_tasks=$(psql "postgresql://postgres:REDACTED_DB_PASS@localhost:5432/postgres" -t -c "SELECT COUNT(*) FROM tasks WHERE created_at >= NOW() - INTERVAL '1 hour';" 2>/dev/null | xargs)
              echo "â° Recent activity: $recent_tasks tasks created in last hour" | tee -a logs/agents-db.log
            else
              echo "âŒ Database not accessible or tables not created" | tee -a logs/agents-db.log
            fi
            sleep 45
          done
        - |
          echo "ðŸ“¨ Starting Kafka for Agents (Event Streaming)..."
          echo "Starting Kafka and Zookeeper via Docker..."
          docker-compose up kafka zookeeper -d
          echo "âœ… Kafka cluster starting..."
          echo ""
          echo "ðŸ“Š Kafka monitoring and topic management..."
          sleep 10
          echo "ðŸ“‹ Creating topics..."
          docker exec -it nullblock-kafka kafka-topics --create --topic task.lifecycle --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1 2>/dev/null || echo "Topic already exists"
          docker exec -it nullblock-kafka kafka-topics --create --topic user.created --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1 2>/dev/null || echo "Topic already exists"
          docker exec -it nullblock-kafka kafka-topics --create --topic user.updated --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1 2>/dev/null || echo "Topic already exists"
          docker exec -it nullblock-kafka kafka-topics --create --topic user.deleted --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1 2>/dev/null || echo "Topic already exists"
          echo "âœ… Topics created"
          echo ""
          echo "ðŸ“¨ Live Kafka Event Monitoring..."
          echo "ðŸ”„ Task Lifecycle Events | ðŸ‘¤ User Events | ðŸ“Š Event Counters"
          echo "=================================================="

          # Start background consumers for different topics with formatting
          (
            echo "ðŸ“‹ Task Lifecycle Events:"
            docker exec -i nullblock-kafka kafka-console-consumer \
              --bootstrap-server localhost:9092 \
              --topic task.lifecycle \
              --from-beginning 2>/dev/null | \
            while IFS= read -r line; do
              echo "$(date '+%H:%M:%S') [TASK] $line"
            done
          ) &

          (
            echo "ðŸ‘¤ User Events:"
            for topic in user.created user.updated user.deleted; do
              docker exec -i nullblock-kafka kafka-console-consumer \
                --bootstrap-server localhost:9092 \
                --topic "$topic" \
                --from-beginning 2>/dev/null | \
              while IFS= read -r line; do
                echo "$(date '+%H:%M:%S') [USER] $topic: $line"
              done &
            done
            wait
          ) &

          # Event counter
          while true; do
            task_events=$(docker exec nullblock-kafka kafka-run-class kafka.tools.ConsumerOffsetChecker \
              --zookeeper localhost:2181 \
              --topic task.lifecycle 2>/dev/null | awk '{sum+=$4} END {print sum+0}' 2>/dev/null || echo "0")
            echo "$(date '+%H:%M:%S') ðŸ“Š Total task events: $task_events"
            sleep 60
          done
        - |
          echo "ðŸŽ¯ Hecate Agent Health & Task Monitoring"
          echo "Real-time monitoring of agent health and task management..."
          echo ""
          mkdir -p logs
          while true; do
            echo "$(date '+%Y-%m-%d %H:%M:%S') [AGENT] Hecate health check..." | tee -a logs/hecate-health.log
            if curl -s --max-time 5 "http://localhost:9003/hecate/health" > /dev/null 2>&1; then
              echo "âœ… Hecate agent healthy" | tee -a logs/hecate-health.log

              # Model status
              curl -s "http://localhost:9003/hecate/model-status" | jq -r '"ðŸ§  Model: " + (.current_model // "unknown") + " | Status: " + (.status // "unknown")' 2>/dev/null | tee -a logs/hecate-health.log

              # Task count
              task_count=$(curl -s "http://localhost:9003/tasks" | jq '.total // 0' 2>/dev/null || echo "0")
              echo "ðŸ“‹ Current tasks: $task_count" | tee -a logs/hecate-health.log

              # Database migration status
              if curl -s --max-time 3 "http://localhost:9003/health" | jq -r '.components.database.status' 2>/dev/null | grep -q "healthy"; then
                echo "ðŸ—„ï¸  Database migrations: âœ… Complete" | tee -a logs/hecate-health.log
              else
                echo "ðŸ—„ï¸  Database migrations: âš ï¸  Check required" | tee -a logs/hecate-health.log
              fi
            else
              echo "âŒ Hecate agent not responding" | tee -a logs/hecate-health.log
            fi
            sleep 30
          done
        - |
          echo "ðŸ“Š Live System Logs - Multi-Service Tailing"
          echo "Real-time log monitoring across Hecate Agent, Erebus Router, and Task System..."
          echo ""
          mkdir -p logs
          echo "ðŸ”„ Starting multi-log tail with service prefixes..."
          echo "=================================================="

          # Multi-log tailing with service identification
          (
            echo "ðŸŽ¯ [HECATE] Starting Hecate Rust agent log monitoring..."
            tail -f /home/sage/nullblock/svc/nullblock-agents/logs/hecate-rust.log 2>/dev/null | \
            while IFS= read -r line; do
              echo "$(date '+%H:%M:%S') [HECATE] $line"
            done
          ) &

          (
            echo "ðŸ”— [EREBUS] Starting Erebus router log monitoring..."
            tail -f /home/sage/nullblock/svc/erebus/logs/erebus.log 2>/dev/null | \
            while IFS= read -r line; do
              echo "$(date '+%H:%M:%S') [EREBUS] $line"
            done
          ) &

          (
            echo "ðŸ“‹ [TASKS] Starting task system log monitoring..."
            tail -f /home/sage/nullblock/logs/task-system.log 2>/dev/null | \
            while IFS= read -r line; do
              echo "$(date '+%H:%M:%S') [TASKS] $line"
            done
          ) &

          (
            echo "ðŸ—„ï¸  [DB] Starting database activity monitoring..."
            tail -f /home/sage/nullblock/logs/agents-db.log 2>/dev/null | \
            while IFS= read -r line; do
              echo "$(date '+%H:%M:%S') [DB] $line"
            done
          ) &

          # Log summary every 2 minutes
          while true; do
            sleep 120
            echo "$(date '+%H:%M:%S') ðŸ“Š [SUMMARY] Multi-service logs active: Hecate Agent, Erebus Router, Task System, Database"
          done

  - nullblock-mcp:
      layout: tiled
      pre_window: |
        if [ -f .env.dev ]; then
          export $(grep -v '^#' .env.dev | xargs -0)
        fi
      panes:
        - |
          echo "ðŸŒ Starting MCP Server..."
          cd svc/nullblock-mcp
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          export MCP_SERVER_HOST=0.0.0.0
          export MCP_SERVER_PORT=8001
          export DATABASE_URL="postgresql://postgres:REDACTED_DB_PASS@localhost:5441/agents"
          echo "ðŸ“ Starting MCP server with database connection..."
          hatch run python3 -m mcp 2>&1 | tee logs/mcp-server.log
        - |
          echo "ðŸ—„ï¸  MCP Database Monitoring"
          echo "PostgreSQL monitoring for MCP data..."
          echo ""
          mkdir -p logs
          while true; do
            echo "$(date '+%Y-%m-%d %H:%M:%S') [MCP-DB] Database status..." | tee -a logs/mcp-db.log
            if pg_isready -h localhost -p 5432 > /dev/null 2>&1; then
              echo "âœ… PostgreSQL connection healthy" | tee -a logs/mcp-db.log
            else
              echo "âŒ PostgreSQL connection failed" | tee -a logs/mcp-db.log
            fi
            sleep 45
          done
        - |
          echo "ðŸ”— Starting IPFS for MCP (Context Storage)..."
          ipfs daemon --enable-gc &
          echo "âœ… IPFS daemon started for context storage"
          echo ""
          echo "ðŸ“Š IPFS monitoring..."
          while true; do
            if ipfs id > /dev/null 2>&1; then
              echo "$(date '+%H:%M:%S') âœ… IPFS daemon healthy"
            else
              echo "$(date '+%H:%M:%S') âŒ IPFS daemon not responding"
            fi
            sleep 60
          done
        - |
          echo "ðŸŒ MCP Server Logs & Health"
          echo "Monitoring MCP server logs and protocol operations..."
          echo ""
          mkdir -p logs
          tail -f logs/mcp-server.log 2>/dev/null || echo "âš ï¸ Waiting for MCP logs..."

  - nullblock-orchestration:
      layout: tiled
      pre_window: |
        if [ -f .env.dev ]; then
          export $(grep -v '^#' .env.dev | xargs -0)
        fi
      panes:
        - |
          echo "ðŸ”„ Starting Orchestration Service..."
          cd svc/nullblock-orchestration
          echo "Installing/updating dependencies with hatch..."
          hatch -e default run pip install -e .
          export ORCHESTRATION_HOST=0.0.0.0
          export ORCHESTRATION_PORT=8002
          export DATABASE_URL="postgresql://postgres:REDACTED_DB_PASS@localhost:5441/agents"
          echo "ðŸ“ Starting orchestration service with database connection..."
          hatch run python3 -m orchestration 2>&1 | tee logs/orchestration.log
        - |
          echo "ðŸ—„ï¸  Orchestration Database Monitoring"
          echo "PostgreSQL monitoring for workflow data..."
          echo ""
          mkdir -p logs
          while true; do
            echo "$(date '+%Y-%m-%d %H:%M:%S') [ORCH-DB] Database status..." | tee -a logs/orchestration-db.log
            if pg_isready -h localhost -p 5432 > /dev/null 2>&1; then
              echo "âœ… PostgreSQL connection healthy" | tee -a logs/orchestration-db.log
            else
              echo "âŒ PostgreSQL connection failed" | tee -a logs/orchestration-db.log
            fi
            sleep 45
          done
        - |
          echo "ðŸ”„ Orchestration Service Logs & Health"
          echo "Monitoring orchestration service logs and workflow processing..."
          echo ""
          mkdir -p logs
          tail -f logs/orchestration.log 2>/dev/null || echo "âš ï¸ Waiting for orchestration logs..."

  - frontend:
      panes:
        - |
          echo "ðŸŽ¨ Starting Frontend (Hecate React App)..."
          cd svc/hecate
          echo "Installing/updating npm dependencies..."
          npm install
          export VITE_MCP_API_URL=http://localhost:8001
          export VITE_EREBUS_API_URL=http://localhost:3000
          export VITE_ORCHESTRATION_API_URL=http://localhost:8002
          export VITE_HECATE_API_URL=http://localhost:9003
          echo "ðŸš€ Starting React development server..."
          npm run develop

on_project_start: |
  if [ ! -f .env.dev ]; then
    echo "Creating .env.dev file..."
    echo "# Nullblock Development Environment" > .env.dev
    echo "ETHEREUM_RPC_URL=https://eth-sepolia.alchemyapi.io/v2/your-key" >> .env.dev
    echo "OPENROUTER_API_KEY=your-openrouter-key-here" >> .env.dev
    echo "Please edit .env.dev with your actual API keys"
  fi
  echo "ðŸ“ Creating log directory structure..."
  mkdir -p logs
  mkdir -p svc/nullblock-agents/logs
  mkdir -p svc/nullblock-mcp/logs
  mkdir -p svc/nullblock-orchestration/logs
  mkdir -p svc/erebus/logs
  mkdir -p svc/hecate/logs
  echo "âœ… Log directories created"
  echo ""
  echo "ðŸš€ Nullblock Development Environment Ready!"
  echo "================================================"
  echo "ðŸ—ï¸  Architecture: Client â†” Erebus â†” Services"
  echo "ðŸ›¡ï¸  Security: All frontend requests route through Erebus (port 3000)"
  echo ""
  echo "ðŸ“¡ Service Ports:"
  echo "   ðŸŒ Erebus (unified router): http://localhost:3000"
  echo "   ðŸ§  MCP Server: http://localhost:8001"
  echo "   ðŸ”„ Orchestration: http://localhost:8002"
  echo "   ðŸŽ¯ Hecate Agent (Rust): http://localhost:9003"
  echo "   ðŸŽ¨ Frontend: http://localhost:5173"
  echo ""
  echo "ðŸ¦€ Rust Services:"
  echo "   âœ… Hecate Agent - High-performance conversational AI"
  echo "   âœ… Erebus Router - Unified request routing & logging"
  echo ""
  echo "ðŸ§  LLM Integration:"
  echo "   âš¡ Provider: OpenRouter (cloud-based)"
  echo "   ðŸŽ¯ Default Model: deepseek/deepseek-chat-v3.1:free ($0.00)"
  echo "   ðŸ’° Cost Tracking: Real-time monitoring & analytics"
  echo ""
  echo "ðŸ“Š Tabs Overview:"
  echo "   ðŸ“ logs - Real-time service logs & health monitoring"
  echo "   ðŸ’» workspace - Development commands & SDK tools"
  echo "   ðŸ—ï¸  infrastructure - PostgreSQL, Redis, IPFS"
  echo "   ðŸ”§ backend - MCP, Orchestration, Erebus services"
  echo "   ðŸ¤– agents - Hecate (Rust) agent server"
  echo "   ðŸŽ¨ frontend - React development server"
  echo "   ðŸ“Š monitoring - OpenRouter & model performance analytics"

on_project_stop: |
  echo "Stopping development services..."
  if [[ "$OSTYPE" == "darwin"* ]]; then
    brew services stop postgresql@17 2>/dev/null || true
    brew services stop redis 2>/dev/null || true
  elif command -v systemctl &> /dev/null; then
    systemctl --user stop postgresql 2>/dev/null || true
    if command -v pacman &> /dev/null; then
      systemctl --user stop redis 2>/dev/null || true
    else
      systemctl --user stop redis-server 2>/dev/null || true
    fi
  fi
  pkill -f "ipfs daemon" 2>/dev/null || true