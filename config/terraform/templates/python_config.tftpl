"""
Generated Python configuration for Nullblock services
Generated by Terraform for environment: ${environment}
Generated on: ${formatdate("YYYY-MM-DD HH:mm:ss", timestamp())}
"""

import os
from typing import Dict, Any, Optional
from dataclasses import dataclass

@dataclass
class ServiceConfig:
    """Configuration for a single service"""
    host: str
    port: int
    name: str
    description: str
    health_endpoint: Optional[str] = None
    docs_endpoint: Optional[str] = None

class NullblockConfig:
    """Generated configuration for Nullblock services"""
    
    def __init__(self):
        # Infrastructure Services
        self.postgresql = ServiceConfig(
            host="${hosts.postgresql}",
            port=${services.postgresql},
            name='PostgreSQL',
            description='${descriptions.postgresql}'
        )
        
        self.redis = ServiceConfig(
            host="${hosts.redis}",
            port=${services.redis},
            name='Redis',
            description='${descriptions.redis}'
        )
        
        self.ipfs = ServiceConfig(
            host="${hosts.ipfs}",
            port=${services.ipfs},
            name='IPFS Daemon',
            description='${descriptions.ipfs}'
        )
        
        # Backend Services
        self.mcp_server = ServiceConfig(
            host="${hosts.mcp_server}",
            port=${services.mcp_server},
            name='MCP Server',
            description='${descriptions.mcp_server}',
            health_endpoint='/health',
            docs_endpoint='/docs'
        )
        
        self.orchestration = ServiceConfig(
            host="${hosts.orchestration}",
            port=${services.orchestration},
            name='Orchestration',
            description='${descriptions.orchestration}',
            health_endpoint='/health',
            docs_endpoint='/docs'
        )
        
        self.erebus = ServiceConfig(
            host="${hosts.erebus}",
            port=${services.erebus},
            name='Erebus',
            description='${descriptions.erebus}',
            health_endpoint='/health',
            docs_endpoint='/docs'
        )
        
        # Agent Services
        self.general_agents = ServiceConfig(
            host="${hosts.general_agents}",
            port=${services.general_agents},
            name='General Agents',
            description='${descriptions.general_agents}',
            health_endpoint='/health',
            docs_endpoint='/docs'
        )
        
        self.hecate_agent = ServiceConfig(
            host="${hosts.hecate_agent}",
            port=${services.hecate_agent},
            name='Hecate Agent',
            description='${descriptions.hecate_agent}',
            health_endpoint='/health',
            docs_endpoint='/docs'
        )
        
        # Frontend Services
        self.frontend = ServiceConfig(
            host="${hosts.frontend}",
            port=${services.frontend},
            name='Frontend',
            description='${descriptions.frontend}'
        )
        
        # LLM Services
        self.lm_studio = ServiceConfig(
            host="${hosts.lm_studio}",
            port=${services.lm_studio},
            name='LM Studio',
            description='${descriptions.lm_studio}'
        )
    
    def get_service_url(self, service: ServiceConfig, endpoint: str = '') -> str:
        """Generate a full URL for a service endpoint"""
        return f"http://{service.host}:{service.port}{endpoint}"
    
    def get_health_url(self, service: ServiceConfig) -> str:
        """Get the health check URL for a service"""
        if service.health_endpoint:
            return self.get_service_url(service, service.health_endpoint)
        return self.get_service_url(service)
    
    def get_docs_url(self, service: ServiceConfig) -> str:
        """Get the documentation URL for a service"""
        if service.docs_endpoint:
            return self.get_service_url(service, service.docs_endpoint)
        return self.get_service_url(service)
    
    def get_all_services(self) -> Dict[str, ServiceConfig]:
        """Get all configured services"""
        return {
            'postgresql': self.postgresql,
            'redis': self.redis,
            'ipfs': self.ipfs,
            'mcp_server': self.mcp_server,
            'orchestration': self.orchestration,
            'erebus': self.erebus,
            'general_agents': self.general_agents,
            'hecate_agent': self.hecate_agent,
            'frontend': self.frontend,
            'lm_studio': self.lm_studio
        }
    
    def validate_ports(self) -> Dict[str, Any]:
        """Validate that all ports are unique"""
        ports = {}
        conflicts = []
        
        for name, service in self.get_all_services().items():
            if service.port in ports:
                conflicts.append({
                    'port': service.port,
                    'services': [ports[service.port], name]
                })
            else:
                ports[service.port] = name
        
        return {
            'valid': len(conflicts) == 0,
            'conflicts': conflicts,
            'port_assignments': ports
        }

# Global configuration instance
config = NullblockConfig()

# Convenience functions
def get_hecate_config() -> ServiceConfig:
    return config.hecate_agent

def get_agents_config() -> ServiceConfig:
    return config.general_agents

def get_mcp_config() -> ServiceConfig:
    return config.mcp_server

def get_frontend_config() -> ServiceConfig:
    return config.frontend

def get_all_service_urls() -> Dict[str, str]:
    """Get all service URLs for frontend configuration"""
    return {
        'VITE_MCP_API_URL': config.get_service_url(config.mcp_server),
        'VITE_EREBUS_API_URL': config.get_service_url(config.erebus),
        'VITE_ORCHESTRATION_API_URL': config.get_service_url(config.orchestration),
        'VITE_AGENTS_API_URL': config.get_service_url(config.general_agents),
        'VITE_HECATE_API_URL': config.get_service_url(config.hecate_agent),
    }
